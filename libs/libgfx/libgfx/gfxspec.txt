# File structure

A GFX file has the following structure:

- File header
- Frames or tiles
- Animations
- Palettes

# File header

| Offset | Size | Type     | Name       | Description
|--------|------|----------|------------| -----------
|      0 |    4 | char[4]  | signature  | "AGFX"
|      4 |    2 | uint16_t | version    | 1
|      6 |    2 | uint16_t | size       | Size of header (21)
|      8 |    2 | uint16_t | width      | Width of a frame or tile in pixels
|     10 |    2 | uint16_t | height     | Height of a frame or tile in pixels
|     12 |    1 | 4 bits   | format     | See section "formats"
|     12 |      | 4 bits   | type       | See section "types"
|     13 |    2 | uint16_t | numFrames  | Number of frames
|     15 |    2 | uint16_t | numTiles   | Number of tiles. This is used to
|                                         separate the regular tile frames from
|                                         the additional frames, that are for
|                                         animation only.
|     17 |    2 | uint16_t | numAnims   | Number of animations
|     19 |    2 | uint16_t | numPals    | Number of palettes included

## Formats

The color format, or just format, defines the format how the pixels of a frame
are defined. The following formats are available:

0 - 4-bit indexed
1 - 8-bit indexed
2 - 4-bit grayscale
3 - 8-bit grayscale
4 - 16-bit RGBA (5 bit for red/green/blue, 1 bit for alpha)
5 - 24-bit RGB
6 - 32-bit RGBA

## Type

This defines the type of data stored inside this file. There is:

0 - none (only palettes)
1 - image
2 - tileset

# Frames or tiles

This section is independent whether the type is image or tileset. In either
case, numFrames (see header) frames are here as a simple array.
The number of bytes per frame can be calculated by:

  bytesPerFrame = width * height * bytesPerPixel

This section has exactly the size of `numFrames * bytesPerFrame`.

# Animations

This section defines multiple lists of frame indices in which order to show the
individual frames. For tileset, an additional frame (tile) index is used to
indicate which tile is to be animated. For images, this has no meaning and can
should be 0.
There are `numAnims` animations. For each animation, the following structure is
given:

| Offset | Size | Type     | Name       | Description
|--------|------|----------|------------| -----------
|      0 |    2 | uint16_t | tileIndex  | Tile to animate (0 for images)
|      2 |    1 | uint8_t  | numFrames  | Number of frames for this animation
|  3 + n |    2 | uint16_t | frameIndex | Frame index at this position.
                                          0 refers to the first frame.

# Palettes

For each palette, the following structure is given:

| Offset | Size | Type     | Name      | Description
|--------|------|----------|-----------| -----------
|      0 |    1 | uint8_t  | format    | Color format. See section "formats".
                                         Indexed formats are not allowed here.
|      1 |    1 | uint8_t  | numColors | Number of colors in the palette.
                                         0 means 256 colors.
|  2 + n |    * | colors   | colors    | Actual colors.
